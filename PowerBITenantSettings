<#
Created by claude AI
to be reviewed!
#>

# ============================================================================
# Power BI Tenant Settings Inventory - FABRIC API VERSION
# ============================================================================

# HELPER FUNCTION - Must be at the top
function Get-SettingCategory {
    param([string]$settingName)
    
    switch -Wildcard ($settingName) {
        "*Export*" { return "Export & Sharing" }
        "*Share*" { return "Export & Sharing" }
        "*Publish*" { return "Export & Sharing" }
        "*Admin*" { return "Admin & API" }
        "*API*" { return "Admin & API" }
        "*ServicePrincipal*" { return "Admin & API" }
        "*Metadata*" { return "Admin & API" }
        "*Workspace*" { return "Workspace Management" }
        "*Capacity*" { return "Capacity & Performance" }
        "*Dataflow*" { return "Dataflows & Datasets" }
        "*Dataset*" { return "Dataflows & Datasets" }
        "*Template*" { return "Development" }
        "*CustomVisual*" { return "Development" }
        "*RScript*" { return "Development" }
        "*Python*" { return "Development" }
        "*Email*" { return "Notifications" }
        "*Subscription*" { return "Notifications" }
        "*Guest*" { return "Security & Access" }
        "*External*" { return "Security & Access" }
        "*B2B*" { return "Security & Access" }
        "*InformationProtection*" { return "Security & Access" }
        "*Sensitivity*" { return "Security & Access" }
        "*Certification*" { return "Governance" }
        "*Endorsement*" { return "Governance" }
        "*Discovery*" { return "Governance" }
        default { return "Other" }
    }
}

function Get-SecurityEvaluation {
    param(
        [string]$settingName,
        [string]$title,
        [bool]$enabled,
        [string]$enabledFor
    )
    
    # Define security rules
    $evaluation = switch -Wildcard ($settingName) {
        # HIGH RISK if enabled for everyone
        "*PublishToWeb*" {
            if ($enabled -and $enabledFor -eq "Entire Organization") {
                @{ Risk = "High Risk"; Color = "#dc3545"; Icon = "üö®"; Reason = "Public internet exposure" }
            } elseif ($enabled) {
                @{ Risk = "Medium Risk"; Color = "#ffc107"; Icon = "‚ö†Ô∏è"; Reason = "Limited public exposure" }
            } else {
                @{ Risk = "Secure"; Color = "#28a745"; Icon = "‚úì"; Reason = "Public sharing disabled" }
            }
        }
        
        "*ShareLinkToEntireOrganization*" {
            if ($enabled -and $enabledFor -eq "Entire Organization") {
                @{ Risk = "Medium Risk"; Color = "#ffc107"; Icon = "‚ö†Ô∏è"; Reason = "Org-wide sharing enabled" }
            } else {
                @{ Risk = "Acceptable"; Color = "#17a2b8"; Icon = "‚ÑπÔ∏è"; Reason = "Controlled sharing" }
            }
        }
        
        "*ExternalDataSharing*" {
            if ($enabled -and $enabledFor -eq "Entire Organization") {
                @{ Risk = "High Risk"; Color = "#dc3545"; Icon = "üö®"; Reason = "External data sharing" }
            } elseif ($enabled) {
                @{ Risk = "Medium Risk"; Color = "#ffc107"; Icon = "‚ö†Ô∏è"; Reason = "Limited external sharing" }
            } else {
                @{ Risk = "Secure"; Color = "#28a745"; Icon = "‚úì"; Reason = "External sharing disabled" }
            }
        }
        
        "*Guest*" {
            if ($enabled -and $enabledFor -eq "Entire Organization") {
                @{ Risk = "Review Required"; Color = "#ffc107"; Icon = "‚ö†Ô∏è"; Reason = "Guest access enabled" }
            } elseif ($enabled) {
                @{ Risk = "Acceptable"; Color = "#17a2b8"; Icon = "‚ÑπÔ∏è"; Reason = "Controlled guest access" }
            } else {
                @{ Risk = "Secure"; Color = "#28a745"; Icon = "‚úì"; Reason = "No guest access" }
            }
        }
        
        # SHOULD BE ENABLED (governance/compliance)
        "*InformationProtection*" {
            if ($enabled) {
                @{ Risk = "Compliant"; Color = "#28a745"; Icon = "‚úì"; Reason = "Data protection enabled" }
            } else {
                @{ Risk = "Compliance Gap"; Color = "#dc3545"; Icon = "üö®"; Reason = "Missing data protection" }
            }
        }
        
        "*Sensitivity*" {
            if ($enabled) {
                @{ Risk = "Compliant"; Color = "#28a745"; Icon = "‚úì"; Reason = "Labeling enabled" }
            } else {
                @{ Risk = "Compliance Gap"; Color = "#ffc107"; Icon = "‚ö†Ô∏è"; Reason = "No sensitivity labels" }
            }
        }
        
        "*Certification*" {
            if ($enabled) {
                @{ Risk = "Good Practice"; Color = "#28a745"; Icon = "‚úì"; Reason = "Certification available" }
            } else {
                @{ Risk = "Governance Gap"; Color = "#ffc107"; Icon = "‚ö†Ô∏è"; Reason = "No certification process" }
            }
        }
        
        "*Endorsement*" {
            if ($enabled) {
                @{ Risk = "Good Practice"; Color = "#28a745"; Icon = "‚úì"; Reason = "Endorsement enabled" }
            } else {
                @{ Risk = "Governance Gap"; Color = "#ffc107"; Icon = "‚ö†Ô∏è"; Reason = "No endorsement" }
            }
        }
        
        # Admin API - should be enabled but restricted
        "*ServicePrincipal*" {
            if ($enabled -and $enabledFor -like "Specific Groups:*") {
                @{ Risk = "Good Practice"; Color = "#28a745"; Icon = "‚úì"; Reason = "API access controlled" }
            } elseif ($enabled -and $enabledFor -eq "Entire Organization") {
                @{ Risk = "Medium Risk"; Color = "#ffc107"; Icon = "‚ö†Ô∏è"; Reason = "Unrestricted API access" }
            } elseif ($enabled) {
                @{ Risk = "Acceptable"; Color = "#17a2b8"; Icon = "‚ÑπÔ∏è"; Reason = "API access enabled" }
            } else {
                @{ Risk = "Limited Capability"; Color = "#6c757d"; Icon = "‚ö†Ô∏è"; Reason = "API disabled" }
            }
        }
        
        "*AdminApi*" {
            if ($enabled) {
                @{ Risk = "Good Practice"; Color = "#28a745"; Icon = "‚úì"; Reason = "Admin capabilities enabled" }
            } else {
                @{ Risk = "Limited Capability"; Color = "#6c757d"; Icon = "‚ÑπÔ∏è"; Reason = "Admin API disabled" }
            }
        }
        
        "*Metadata*" {
            if ($enabled) {
                @{ Risk = "Good Practice"; Color = "#28a745"; Icon = "‚úì"; Reason = "Metadata access enabled" }
            } else {
                @{ Risk = "Limited Capability"; Color = "#6c757d"; Icon = "‚ÑπÔ∏è"; Reason = "Metadata access limited" }
            }
        }
        
        # Export capabilities - generally acceptable
        "*ExportToExcel*" {
            @{ Risk = "Acceptable"; Color = "#17a2b8"; Icon = "‚ÑπÔ∏è"; Reason = "Standard export capability" }
        }
        
        "*ExportReport*" {
            @{ Risk = "Acceptable"; Color = "#17a2b8"; Icon = "‚ÑπÔ∏è"; Reason = "Standard export capability" }
        }
        
        "*PrintReport*" {
            @{ Risk = "Acceptable"; Color = "#17a2b8"; Icon = "‚ÑπÔ∏è"; Reason = "Standard capability" }
        }
        
        # Development features - depends on use case
        "*CustomVisual*" {
            if ($enabled -and $enabledFor -eq "Entire Organization") {
                @{ Risk = "Review Required"; Color = "#ffc107"; Icon = "‚ö†Ô∏è"; Reason = "Uncertified visuals allowed" }
            } else {
                @{ Risk = "Acceptable"; Color = "#17a2b8"; Icon = "‚ÑπÔ∏è"; Reason = "Controlled visual usage" }
            }
        }
        
        "*RScript*" {
            if ($enabled) {
                @{ Risk = "Review Required"; Color = "#ffc107"; Icon = "‚ö†Ô∏è"; Reason = "Code execution enabled" }
            } else {
                @{ Risk = "Secure"; Color = "#28a745"; Icon = "‚úì"; Reason = "Script execution disabled" }
            }
        }
        
        "*Python*" {
            if ($enabled) {
                @{ Risk = "Review Required"; Color = "#ffc107"; Icon = "‚ö†Ô∏è"; Reason = "Code execution enabled" }
            } else {
                @{ Risk = "Secure"; Color = "#28a745"; Icon = "‚úì"; Reason = "Script execution disabled" }
            }
        }
        
        # Default for other settings
        default {
            @{ Risk = "Standard"; Color = "#6c757d"; Icon = "‚Äî"; Reason = "Standard setting" }
        }
    }
    
    return $evaluation
}

$timestamp = Get-Date -Format "yyyyMMdd_HHmmss"
$reportDate = Get-Date -Format "yyyy-MM-dd HH:mm"

Write-Host "========================================" -ForegroundColor Cyan
Write-Host "POWER BI TENANT SETTINGS EXPORT" -ForegroundColor Cyan
Write-Host "========================================`n" -ForegroundColor Cyan

# Connect using Azure Account
Write-Host "Connecting to Azure..." -ForegroundColor Yellow
Connect-AzAccount

# Get token for Fabric API
Write-Host "Getting access token..." -ForegroundColor Yellow
$tokenResponse = Get-AzAccessToken -ResourceUrl "https://api.fabric.microsoft.com"
$token = $tokenResponse.Token

Write-Host "‚úì Token acquired`n" -ForegroundColor Green

# Get all tenant settings
Write-Host "Retrieving tenant settings from Fabric API..." -ForegroundColor Yellow

try {
    $response = Invoke-RestMethod `
        -Uri "https://api.fabric.microsoft.com/v1/admin/tenantsettings" -Method Get -Authentication Bearer -Token $token
    
    Write-Host "‚úì Retrieved $($response.tenantSettings.Count) settings`n" -ForegroundColor Green
}
catch {
    Write-Host "‚úó Failed to retrieve settings: $($_.Exception.Message)" -ForegroundColor Red
    # exit
}

# ============================================================================
# PARSE AND STRUCTURE SETTINGS
# ============================================================================

Write-Host "Processing settings..." -ForegroundColor Yellow

$allSettings = foreach ($setting in $response.tenantSettings) {
    
    # Determine who can use this setting
    $enabledFor = if ($setting.enabled -eq $true) {
        if ($setting.canSpecifySecurityGroups -eq $true) {
            if ($setting.tenantSettingGroup) {
                $groupNames = ($setting.tenantSettingGroup | ForEach-Object { $_.groupName }) -join "; "
                "Specific Groups: $groupNames"
            }
            elseif ($setting.excludedSecurityGroups) {
                $excludedNames = ($setting.excludedSecurityGroups | ForEach-Object { $_.groupName }) -join "; "
                "All Users (except: $excludedNames)"
            }
            else {
                "Entire Organization"
            }
        }
        else {
            "Entire Organization"
        }
    }
    elseif ($setting.enabled -eq $false) {
        "Disabled"
    }
    else {
        "Not Configured"
    }
    
    $delegatedTo = if ($setting.delegatedToUsers) {
        ($setting.delegatedToUsers | ForEach-Object { $_.groupName }) -join "; "
    }
    else {
        "N/A"
    }
    
    $properties = if ($setting.properties) {
        ($setting.properties | ForEach-Object { "$($_.name): $($_.value)" }) -join "; "
    }
    else {
        ""
    }
    
    # Get category and security evaluation
    $category = Get-SettingCategory -settingName $setting.settingName
    $securityEval = Get-SecurityEvaluation -settingName $setting.settingName -title $setting.title -enabled $setting.enabled -enabledFor $enabledFor
    
    [PSCustomObject]@{
        SettingName              = $setting.settingName
        Title                    = $setting.title
        Category                 = $category
        Enabled                  = $setting.enabled
        EnabledFor               = $enabledFor
        SecurityRisk             = $securityEval.Risk
        RiskReason               = $securityEval.Reason
        CanSpecifySecurityGroups = $setting.canSpecifySecurityGroups
        DelegatedToUsers         = $delegatedTo
        AdditionalProperties     = $properties
        RiskColor                = $securityEval.Color
        RiskIcon                 = $securityEval.Icon
    }
}

# ============================================================================
# EXPORT TO CSV
# ============================================================================

$csvPath = "PowerBI_TenantSettings_$timestamp.csv"
$allSettings | Select-Object SettingName, Title, Category, Enabled, EnabledFor, SecurityRisk, RiskReason, CanSpecifySecurityGroups, DelegatedToUsers, AdditionalProperties |
    Export-Csv -Path $csvPath -NoTypeInformation -Encoding UTF8

Write-Host "‚úì Settings exported to CSV: $csvPath`n" -ForegroundColor Green

# ============================================================================
# ANALYSIS - Security Summary
# ============================================================================

Write-Host "Analyzing security posture..." -ForegroundColor Yellow

$securitySummary = $allSettings | Group-Object SecurityRisk | ForEach-Object {
    [PSCustomObject]@{
        RiskLevel = $_.Name
        Count = $_.Count
        Percentage = [Math]::Round(($_.Count / $allSettings.Count) * 100, 1)
    }
} | Sort-Object Count -Descending

# ============================================================================
# ANALYSIS - Category Summary (without enabled/disabled counts)
# ============================================================================

$categorySummary = $allSettings | Group-Object Category | ForEach-Object {
    $highRisk = ($_.Group | Where-Object { $_.SecurityRisk -eq "High Risk" }).Count
    $mediumRisk = ($_.Group | Where-Object { $_.SecurityRisk -eq "Medium Risk" }).Count
    $complianceGap = ($_.Group | Where-Object { $_.SecurityRisk -like "*Gap*" }).Count
    
    [PSCustomObject]@{
        Category = $_.Name
        Total = $_.Count
        HighRisk = $highRisk
        MediumRisk = $mediumRisk
        ComplianceGaps = $complianceGap
    }
} | Sort-Object Category

# ============================================================================
# ANALYSIS - Critical Findings
# ============================================================================

$highRiskSettings = $allSettings | Where-Object { $_.SecurityRisk -eq "High Risk" }
$complianceGaps = $allSettings | Where-Object { $_.SecurityRisk -like "*Gap*" }
$goodPractices = $allSettings | Where-Object { $_.SecurityRisk -like "*Good Practice*" -or $_.SecurityRisk -eq "Compliant" }

# ============================================================================
# BUILD COMPREHENSIVE HTML REPORT
# ============================================================================

Write-Host "Building HTML report..." -ForegroundColor Yellow

$sb = New-Object System.Text.StringBuilder

# Security summary metrics HTML
$securityMetricsHtml = ($securitySummary | ForEach-Object {
    $color = switch ($_.RiskLevel) {
        "High Risk" { "#dc3545" }
        "Medium Risk" { "#ffc107" }
        "Compliance Gap" { "#fd7e14" }
        "Governance Gap" { "#ffc107" }
        "Review Required" { "#17a2b8" }
        "Good Practice" { "#28a745" }
        "Compliant" { "#28a745" }
        "Secure" { "#28a745" }
        "Acceptable" { "#17a2b8" }
        default { "#6c757d" }
    }
    
    "<div class='metric-card' style='border-left-color: $color;'>
        <h4>$($_.RiskLevel)</h4>
        <div class='value' style='color: $color;'>$($_.Count)</div>
        <div class='subvalue'>$($_.Percentage)% of all settings</div>
    </div>"
}) -join "`n"

# All settings table HTML with security evaluation
$allSettingsTableHtml = ($allSettings | Sort-Object Category, Title | ForEach-Object {
    $statusBadge = if ($_.Enabled) { 
        "<span style='background:#28a745; color:white; padding:3px 8px; border-radius:10px; font-size:0.75em;'>ON</span>" 
    } else { 
        "<span style='background:#6c757d; color:white; padding:3px 8px; border-radius:10px; font-size:0.75em;'>OFF</span>" 
    }
    
    "<tr>
        <td>$($_.Category)</td>
        <td><strong>$($_.Title)</strong><br><small style='color:#666;'>$($_.SettingName)</small></td>
        <td style='text-align:center;'>$statusBadge</td>
        <td>$($_.EnabledFor)</td>
        <td style='text-align:center;'>
            <span style='background:$($_.RiskColor); color:white; padding:4px 12px; border-radius:12px; font-weight:600; font-size:0.85em;'>
                $($_.RiskIcon) $($_.SecurityRisk)
            </span>
            <br><small style='color:#666; font-size:0.8em;'>$($_.RiskReason)</small>
        </td>
    </tr>"
}) -join "`n"

# High risk settings alert HTML
$highRiskHtml = if ($highRiskSettings) {
    ($highRiskSettings | ForEach-Object {
        "<div class='alert alert-danger'>
            <strong>üö® $($_.Title)</strong><br>
            Status: $(if ($_.Enabled) { 'ENABLED' } else { 'DISABLED' }) | Enabled for: $($_.EnabledFor)<br>
            <small>Risk: $($_.RiskReason)</small>
        </div>"
    }) -join "`n"
} else {
    "<div class='alert alert-success'><strong>‚úì No high-risk settings found</strong></div>"
}

# Compliance gaps HTML
$complianceGapsHtml = if ($complianceGaps) {
    ($complianceGaps | ForEach-Object {
        "<div class='alert alert-warning'>
            <strong>‚ö†Ô∏è $($_.Title)</strong><br>
            Status: $(if ($_.Enabled) { 'ENABLED' } else { 'DISABLED' }) | Issue: $($_.RiskReason)<br>
            <small>Recommendation: Enable this setting for better governance and compliance</small>
        </div>"
    }) -join "`n"
} else {
    "<div class='alert alert-success'><strong>‚úì No compliance gaps identified</strong></div>"
}

# Good practices HTML
$goodPracticesHtml = if ($goodPractices) {
    "<div class='alert alert-success'>
        <strong>‚úì Good Practices Implemented: $($goodPractices.Count)</strong><br>
        <small>Settings properly configured: " + (($goodPractices | Select-Object -First 5 -ExpandProperty Title) -join ", ") + "...</small>
    </div>"
} else {
    ""
}

# Category summary table HTML
$categorySummaryHtml = ($categorySummary | ForEach-Object {
    $riskIndicator = if ($_.HighRisk -gt 0) {
        "<span style='color:#dc3545; font-weight:bold;'>‚ö†Ô∏è $($_.HighRisk)</span>"
    } else {
        "<span style='color:#28a745;'>‚úì</span>"
    }
    
    "<tr>
        <td><strong>$($_.Category)</strong></td>
        <td style='text-align:center;'>$($_.Total)</td>
        <td style='text-align:center;'>$riskIndicator</td>
        <td style='text-align:center;'>$(if ($_.MediumRisk -gt 0) { "<span style='color:#ffc107;'>$($_.MediumRisk)</span>" } else { "‚Äî" })</td>
        <td style='text-align:center;'>$(if ($_.ComplianceGaps -gt 0) { "<span style='color:#fd7e14;'>$($_.ComplianceGaps)</span>" } else { "‚Äî" })</td>
    </tr>"
}) -join "`n"

# Build complete HTML
[void]$sb.AppendLine(@"
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Power BI Tenant Settings Security Report - $reportDate</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; color: #333; line-height: 1.6; }
        .container { max-width: 1600px; margin: 0 auto; padding: 20px; }
        header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px; border-radius: 10px; margin-bottom: 30px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        header h1 { font-size: 2.5em; margin-bottom: 10px; }
        header p { font-size: 1.1em; opacity: 0.9; }
        .section { background: white; padding: 30px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .section h2 { color: #667eea; border-bottom: 3px solid #667eea; padding-bottom: 10px; margin-bottom: 20px; font-size: 1.8em; }
        .section h3 { color: #764ba2; margin-top: 25px; margin-bottom: 15px; font-size: 1.3em; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th { background: #667eea; color: white; padding: 12px; text-align: left; font-weight: 600; position: sticky; top: 0; }
        td { padding: 10px 12px; border-bottom: 1px solid #e0e0e0; vertical-align: top; }
        tr:hover { background: #f8f9fa; }
        .metric-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin: 20px 0; }
        .metric-card { background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); padding: 20px; border-radius: 8px; border-left: 4px solid #667eea; }
        .metric-card h4 { color: #555; font-size: 0.9em; margin-bottom: 10px; text-transform: uppercase; }
        .metric-card .value { font-size: 2em; font-weight: bold; color: #333; }
        .metric-card .subvalue { color: #666; font-size: 0.85em; margin-top: 5px; }
        .alert { padding: 15px 20px; border-radius: 8px; margin: 15px 0; border-left: 4px solid; }
        .alert-danger { background: #f8d7da; border-color: #dc3545; color: #721c24; }
        .alert-warning { background: #fff3cd; border-color: #ffc107; color: #856404; }
        .alert-success { background: #d4edda; border-color: #28a745; color: #155724; }
        footer { text-align: center; padding: 30px; color: #666; font-size: 0.9em; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîê Power BI Tenant Settings Security Report</h1>
            <p>Generated: $reportDate</p>
            <p>Source: Fabric API | Total Settings Analyzed: $($allSettings.Count)</p>
        </header>
        
        <!-- SECURITY POSTURE SUMMARY -->
        <div class="section">
            <h2>üéØ Security Posture Overview</h2>
            <div class="metric-grid">
                $securityMetricsHtml
            </div>
        </div>
        
        <!-- HIGH RISK SETTINGS -->
        <div class="section">
            <h2>üö® High Risk Settings</h2>
            <p>Settings that pose significant security or compliance risks in their current state.</p>
            $highRiskHtml
        </div>
        
        <!-- COMPLIANCE GAPS -->
        <div class="section">
            <h2>üìã Compliance & Governance Gaps</h2>
            <p>Settings that should be enabled for better governance, compliance, and security.</p>
            $complianceGapsHtml
        </div>
        
        <!-- GOOD PRACTICES -->
        $(if ($goodPractices) {
            "<div class='section'>
                <h2>‚úÖ Implemented Good Practices</h2>
                $goodPracticesHtml
            </div>"
        })
        
        <!-- CATEGORY RISK ANALYSIS -->
        <div class="section">
            <h2>üìÅ Risk Analysis by Category</h2>
            <table>
                <thead>
                    <tr>
                        <th>Category</th>
                        <th style="text-align:center;">Total Settings</th>
                        <th style="text-align:center;">High Risk</th>
                        <th style="text-align:center;">Medium Risk</th>
                        <th style="text-align:center;">Compliance Gaps</th>
                    </tr>
                </thead>
                <tbody>
                    $categorySummaryHtml
                </tbody>
            </table>
        </div>
        
        <!-- ALL SETTINGS WITH SECURITY EVALUATION -->
        <div class="section">
            <h2>üìã All Tenant Settings (with Security Evaluation)</h2>
            <p>Complete list with risk assessment for each setting. Use Ctrl+F to search.</p>
            <table>
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>Setting</th>
                        <th style="text-align:center;">Status</th>
                        <th>Enabled For</th>
                        <th style="text-align:center; min-width:200px;">Security Evaluation</th>
                    </tr>
                </thead>
                <tbody>
                    $allSettingsTableHtml
                </tbody>
            </table>
        </div>
        
        <footer>
            <p>Power BI Tenant Settings Security Report</p>
            <p>Generated: $reportDate | CSV Export: $csvPath</p>
        </footer>
    </div>
</body>
</html>
"@)

# Save HTML
$htmlPath = "PowerBI_TenantSettings_SecurityReport_$timestamp.html"
$sb.ToString() | Out-File -FilePath $htmlPath -Encoding UTF8

Write-Host "`n========================================" -ForegroundColor Green
Write-Host "‚úì EXPORT COMPLETE" -ForegroundColor Green
Write-Host "========================================" -ForegroundColor Green
Write-Host "Total Settings: $($allSettings.Count)" -ForegroundColor White
Write-Host "High Risk: $(($highRiskSettings).Count)" -ForegroundColor Red
Write-Host "Compliance Gaps: $(($complianceGaps).Count)" -ForegroundColor Yellow
Write-Host "Good Practices: $(($goodPractices).Count)" -ForegroundColor Green
Write-Host "`nFiles created:" -ForegroundColor Cyan
Write-Host "  CSV:  $csvPath" -ForegroundColor White
Write-Host "  HTML: $htmlPath" -ForegroundColor White
Write-Host "`nOpening HTML report..." -ForegroundColor Cyan

Start-Process $htmlPath

Write-Host "`n‚úì Done!" -ForegroundColor Green
